Administrar bibliotecas compartidas 


bibliotecas compartidas (shared libraries), tambien conocidas como objetos compartidos (shared objects)

Concepto de libreria compartidas
Son colecciones de código que están destinadas a ser utilizadas por muchos programas diferentes; así como las bibliotecas físicas guardan libros y otros recursos para ser utilizados por muchas personas diferentes.


dos pasos para construir un ejecutable a partir del codigo fuente
-> Compilador, convierte el codigo fuente en codigo de maquina, que se almacena en los llamados object files
-> linker, combina los arhivos de objetos y los vincula a las bibliotecas para generar el arhcvio ejecutable final, en enlace puede hacerse statically (esteticamente) o dynamically (dinamicamente)

Bibliotecas estatcas
	Una biblioteca estática se fusiona con el programa en el momento del enlace. Una copia del código de la biblioteca se incrusta en el programa y se convierte en parte de él. Por lo tanto, el programa no tiene dependencias de la biblioteca en tiempo de ejecución porque el programa ya contiene el código de la biblioteca. No tener dependencias puede verse como una ventaja, ya que no tiene que preocuparse por asegurarse de que las bibliotecas utilizadas siempre estén disponibles. En el lado negativo, los programas vinculados estáticamente son más pesados.

Bibliotecas compartidas (o dinamicas)
En el caso de las bibliotecas compartidas, el enlazador simplemente se encarga de que el programa haga referencia a las bibliotecas correctamente. Sin embargo, el vinculador no copia ningún código de biblioteca en el archivo del programa. Sin embargo, en tiempo de ejecución, la biblioteca compartida debe estar disponible para satisfacer las dependencias del programa. Este es un enfoque económico para administrar los recursos del sistema, ya que ayuda a reducir el tamaño de los archivos de programa y solo se carga una copia de la biblioteca en la memoria, incluso cuando es utilizada por varios programas.


Convenciones de nomenglatura de archivos de objetos compartidos
El nombre de una biblioteca (soname), se compone de 3 elementos:
	-> Nombre de la biblioteca (normalmente precedido por lib)
	-> so (que significa "objeto compartido")
	->Numero de version de la biblioteca


Ejemplo: libpthread.so.0

Por el contrario, el nombre de las bibliotecas estaticas terminan en .a p, ejemplo: libpthread.a


Ubicaciones comunes para las bibliotecas compartidas en un sistema Linux son:

    /lib
    /lib32
    /lib64
    /usr/lib
    /usr/local/lib

NOta:El concepto de bibliotecas compartidas no es exclusivo de linux. En windows, por ejemplo, se denominan DDL, que significa dynamic linked libraries (bibliotecas vinculadas dinamicamente)




Configuracion de rutas de bibliotecas compartidas
Las referencias contenidas en los programas vinculados dinámicamente se resuelven mediante el vinculador dinámico (ld.so o ld-linux.so) cuando se ejecuta el programa

La ruta de la biblioteca se configura en el directorio /etc, es decir, en el archivo /etc/ld.so.conf y, más común hoy en día, en archivos que residen en el directorio /etc/ld.so.conf.d. Normalmente, el primero incluye una sola línea include para los archivos *.conf en el segundo:

$ cat /etc/ld.so.conf
include /etc/ld.so.conf.d/*.conf

El directorio /etc/ld.so.conf.d contiene archivos *.conf:
$ ls /etc/ld.so.conf.d/
libc.conf  x86_64-linux-gnu.conf

Estos archivos *.conf deben incluir las rutas absolutas a los directorios de las bibliotecas compartidas:
$ cat /etc/ld.so.conf.d/x86_64-linux-gnu.conf
# Multiarch support
/lib/x86_64-linux-gnu
/usr/lib/x86_64-linux-gnu

El comando ldconfig se encarga de leer estos archivos de configuración, creando el conjunto de enlaces simbólicos antes mencionados que ayudan a localizar las bibliotecas individuales y finalmente a actualizar el archivo de caché /etc/ld.so.cache. Por lo tanto, ldconfig debe ejecutarse cada vez que se agregan o actualizan archivos de configuración

ldconfig: crea conjunto de enlaces simbolicos, que ayudan a localizar las bibliotecas individuales y actualizar el arhcivo cache /etc/ld.so.cache
	-v, --verbose	Muestra los numeros de version de la biblioteca, el nombre de cada directorio y los enlaces que se crean
	-p, --print-cache	Imprime las listas de directorios y bibliotecas candidatas almacenadas en la cache actual
	
Ademas de los archivos de condiguracion, la variable LD_LIBRARY_PATH se puede usar para agregar nuevas rutas para bibliotecas compartidas temporalmente

Está formado por un conjunto de directorios separados por dos puntos (:) donde se buscan las bibliotecas. Para agregar, por ejemplo, /usr/local/mylib a la ruta de la biblioteca en la sesión de shell actual, puede teclear:

$ LD_LIBRARY_PATH=/usr/local/mylib

Ahora puede verificar su valor:

$ echo $LD_LIBRARY_PATH
/usr/local/mylib



Para eliminar la variable, simplemente, usaremos:  unset LD_LIBRARY_PATH
y para que sea permanente, lo agregaremos en los scripts de inicializacion de bash, como /etc/bash.bashrc o ~/.bashrc




Buscando dependencia de un ejecutable particular
ldd seguido de la ruta absoluta al programa, el resultado muestra la ruta del archivo de la biblioteca compartida, asi como la direccion de memoria hexadecimal en la que se carga
	-u, --unused	imprime las dependencias directas no utilizadas (si excisten)
La razón de las dependencias no utilizadas está relacionada con las opciones utilizadas por el vinculador al construir el binario. 


readelf    Muestra información sobre archivos ELF (ELF significa executable and linkable format).
objdump    Imprime información de archivos de objetos.



